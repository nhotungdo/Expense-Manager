@page
@model MoneyTracker.Pages.DashboardModel
@{
    ViewData["Title"] = "Dashboard - Money Tracking";
}

<script>
    // Redirect to appropriate dashboard based on user role
    window.location.href = '/UserDashboard';
</script>

<div class="flopay-container">
    <!-- Left Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2 class="logo">Money Tracking</h2>
        </div>
        <nav class="sidebar-nav">
            <ul class="nav-list">
                <li class="nav-item active">
                    <a href="/Dashboard" class="nav-link">
                        <i class="fas fa-th-large"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/Expenses" class="nav-link">
                        <i class="fas fa-shopping-cart"></i>
                        <span>Your shop</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <i class="fas fa-building"></i>
                        <span>Pay Merchant</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <i class="fas fa-clipboard-list"></i>
                        <span>Orders</span>
                    </a>
                </li>
                <li class="nav-item dropdown">
                    <a href="#" class="nav-link">
                        <i class="fas fa-chart-bar"></i>
                        <span>Reports</span>
                        <i class="fas fa-chevron-down dropdown-arrow"></i>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <i class="fas fa-folder"></i>
                        <span>Collections</span>
                    </a>
                </li>
                <li class="nav-item dropdown">
                    <a href="#" class="nav-link">
                        <i class="fas fa-sync-alt"></i>
                        <span>Repayments</span>
                        <i class="fas fa-chevron-down dropdown-arrow"></i>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <i class="fas fa-wallet"></i>
                        <span>Wallet</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/Profile" class="nav-link">
                        <i class="fas fa-cog"></i>
                        <span>Manage</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Navigation Bar -->
        <div class="top-nav">
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" placeholder="Search for merchants or item." class="search-input">
            </div>
            <div class="top-nav-actions">
                <button class="nav-action-btn">
                    <i class="fas fa-bell"></i>
                </button>
                <button class="nav-action-btn">
                    <i class="fas fa-cog"></i>
                </button>
                <div class="user-profile">
                    <div class="user-avatar">AT</div>
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
        </div>

        <!-- Dashboard Content -->
        <div class="dashboard-content">
            <!-- Balance Card -->
            <div class="balance-card">
                <div class="balance-content">
                    <div class="balance-info">
                        <h3 class="balance-title">Your Balance</h3>
                        <div class="balance-amount" id="currentBalance">$14,231.00</div>
                    </div>
                    <div class="balance-actions">
                        <button class="balance-btn">
                            <i class="fas fa-wallet"></i>
                            Wallet
                        </button>
                        <button class="balance-btn">
                            <i class="fas fa-download"></i>
                            Deposit
                        </button>
                    </div>
                </div>
                <div class="balance-waves">
                    <svg viewBox="0 0 1200 120" preserveAspectRatio="none">
                        <path
                            d="M0,0V46.29c47.79,22.2,103.59,32.17,158,28,70.36-5.37,136.33-33.31,206.8-37.5C438.64,32.43,512.34,53.67,583,72.05c69.27,18,138.3,24.88,209.4,13.08,36.15-6,69.85-17.84,104.45-29.34C989.49,25,1113-14.29,1200,52.47V0Z"
                            opacity=".25" fill="currentColor"></path>
                        <path
                            d="M0,0V15.81C13,36.92,27.64,56.86,47.69,72.05,99.41,111.27,165,111,224.58,91.58c31.15-10.15,60.09-26.07,89.67-39.8,40.92-19,84.73-46,130.83-49.67,36.26-2.85,70.9,9.42,98.6,31.56,31.77,25.39,62.32,62,103.63,73,40.44,10.79,81.35-6.69,119.13-24.28s75.16-39,116.92-43.05c59.73-5.85,113.28,22.88,168.9,38.84,30.2,8.66,59,6.17,87.09-7.5,22.43-10.89,48-26.93,60.65-49.24V0Z"
                            opacity=".5" fill="currentColor"></path>
                        <path
                            d="M0,0V5.63C149.93,59,314.09,71.32,475.83,42.57c43-7.64,84.23-20.12,127.61-26.46,59-8.63,112.48,12.24,165.56,35.4C827.93,77.22,886,95.24,951.2,90c86.53-7,172.46-45.71,248.8-84.81V0Z"
                            fill="currentColor"></path>
                    </svg>
                </div>
            </div>

            <!-- Summary Cards -->
            <div class="summary-cards">
                <div class="summary-card home-card">
                    <div class="card-icon home-icon">
                        <i class="fas fa-home"></i>
                    </div>
                    <div class="card-amount">$3,021.00</div>
                    <div class="card-label">Home</div>
                </div>
                <div class="summary-card electricity-card">
                    <div class="card-icon electricity-icon">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <div class="card-amount">$2,100.00</div>
                    <div class="card-label">Electricity</div>
                </div>
                <div class="summary-card gardening-card">
                    <div class="card-icon gardening-icon">
                        <i class="fas fa-seedling"></i>
                    </div>
                    <div class="card-amount">$3,320.00</div>
                    <div class="card-label">Gardening</div>
                </div>
            </div>

            <!-- Bottom Section -->
            <div class="bottom-section">
                <!-- Pending Payments -->
                <div class="pending-payments">
                    <div class="section-header">
                        <div class="section-title">
                            <h3>Need a payment</h3>
                            <span class="pending-count">12 pending actions</span>
                        </div>
                        <button class="view-all-btn">
                            View All
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                    <div class="pending-list">
                        <div class="pending-item">
                            <div class="pending-icon">
                                <i class="fas fa-file-invoice"></i>
                            </div>
                            <div class="pending-info">
                                <div class="merchant-name">Best Buy</div>
                                <div class="pending-issue">Missing bill.</div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="pending-item">
                            <div class="pending-icon">
                                <i class="fas fa-credit-card"></i>
                            </div>
                            <div class="pending-info">
                                <div class="merchant-name">Target</div>
                                <div class="pending-issue">Incorrect payment details.</div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="pending-item">
                            <div class="pending-icon">
                                <i class="fas fa-ban"></i>
                            </div>
                            <div class="pending-info">
                                <div class="merchant-name">Walmart</div>
                                <div class="pending-issue">Not enough balance.</div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="pending-item">
                            <div class="pending-icon">
                                <i class="fas fa-box"></i>
                            </div>
                            <div class="pending-info">
                                <div class="merchant-name">Amazon</div>
                                <div class="pending-issue">Out of stock.</div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="pending-item">
                            <div class="pending-icon">
                                <i class="fas fa-file-invoice"></i>
                            </div>
                            <div class="pending-info">
                                <div class="merchant-name">Costco</div>
                                <div class="pending-issue">Payment overdue</div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                </div>

                <!-- Transaction History -->
                <div class="transaction-history">
                    <div class="section-header">
                        <div class="section-title">
                            <h3>Transaction history</h3>
                            <span class="account-info">Linked Account ***3400</span>
                        </div>
                        <button class="add-new-btn">
                            <i class="fas fa-plus"></i>
                            Add New
                        </button>
                    </div>
                    <div class="transaction-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Merchant Name</th>
                                    <th>Amount</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="transactionTableBody">
                                <tr>
                                    <td>Amazon</td>
                                    <td>$1,249.99</td>
                                    <td>April 10, 2025</td>
                                    <td><span class="status-badge pending">Pending</span></td>
                                </tr>
                                <tr>
                                    <td>Walmart</td>
                                    <td>$1,732.50</td>
                                    <td>April 2, 2025</td>
                                    <td><span class="status-badge completed">Completed</span></td>
                                </tr>
                                <tr>
                                    <td>Target</td>
                                    <td>$2,089.00</td>
                                    <td>March 21, 2025</td>
                                    <td><span class="status-badge completed">Completed</span></td>
                                </tr>
                                <tr>
                                    <td>Best Buy</td>
                                    <td>$3,199.75</td>
                                    <td>March 3, 2025</td>
                                    <td><span class="status-badge failed">Failed</span></td>
                                </tr>
                                <tr>
                                    <td>Costco</td>
                                    <td>$4,580.20</td>
                                    <td>February 14, 2025</td>
                                    <td><span class="status-badge completed">Completed</span></td>
                                </tr>
                                <tr>
                                    <td>Home Depot</td>
                                    <td>$5,345.95</td>
                                    <td>January 8, 2025</td>
                                    <td><span class="status-badge failed">Failed</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Load dashboard data
        async function loadDashboardData() {
            try {
                // For testing, use mock data instead of API call
                const mockData = {
                    netWorth: 14231.00,
                    monthlyIncome: 8500.00,
                    monthlyExpenses: 6200.00
                };
                updateDashboardUI(mockData);

                // Uncomment below for real API integration
                /*
                const response = await fetch('/api/dashboard', {
                    headers: {
                        'Authorization': 'Bearer ' + getToken()
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    updateDashboardUI(data);
                } else if (response.status === 401) {
                    window.location.href = '/Login';
                }
                */
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                // Use mock data as fallback
                const mockData = {
                    netWorth: 14231.00,
                    monthlyIncome: 8500.00,
                    monthlyExpenses: 6200.00
                };
                updateDashboardUI(mockData);
            }
        }

        function updateDashboardUI(data) {
            // Update balance
            if (data.netWorth !== undefined) {
                document.getElementById('currentBalance').textContent = formatCurrency(data.netWorth);
            }
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD'
            }).format(amount);
        }

        function getToken() {
            return localStorage.getItem('authToken') || '';
        }

        // Initialize dashboard
        $(document).ready(function () {
            // For now, allow access without authentication for testing
            // const token = localStorage.getItem('authToken');
            // if (!token) {
            //     window.location.href = '/Login';
            //     return;
            // }
            loadDashboardData();
        });
    </script>
}